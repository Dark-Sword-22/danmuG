# 如何获取ID信息

总的来说，我们的重投软件做的工作只是将浏览器上发送弹幕的这一具体操作机械化地重复而已（只不过多加了一步是投递前向协调服务器问一问我该发什么，以避免与其他用户重复或遗漏的现象）。这种操作并无魔法，所以与使用浏览器一样需要先登录再发弹幕，从软件的角度说即是需要你输入一个登录信息才能使用。

基本上，由于我们日常使用的http协议和浏览器在你看不到的地方已经做了很多保护措施，比如专门划出一块数据区域，禁止所有代码访问其内容。这样我们将身份和秘钥等敏感信息储存其中，则可以避免其被恶意代码神不知鬼不觉地偷走的风险，理论上只有当用户自愿地打开控制台查看原始数据时（如同你接下来要做的那样）它才会暴露。在大多数时候这很好，因为它让如你我这样毫无互联网知识的人也能愉快地网上冲浪，而不必打开每个网站时都胆战心惊。但是在目前我们的特殊需求下（希望重投弹幕）则带来了一些麻烦，因为我们无法写一个程序自动帮你把登录身份信息提取出来。

这篇文章希望以图文的形式帮助完全小白的朋友在两分钟之内提取出需需要的信息。

### 事前准备

首先你需要有一个B站账号，理论上它最好是小号。虽然大号有一定的好处，比如投递弹幕时允许的尺度会更高一些，允许的内容会更长一些。但总的来说毕竟作为一种暴露秘钥的行为，它总是带有某种程度的风险。虽然我们的程序不含任何会发送你秘钥的代码，但理论上这种风险操作最好有小号来完成。

另一点值得注意的就是，虽然我们的投稿策略设定得非常缓和，以求最大限度上避免触发B站的机器人拦截策略。但是毕竟此种行为无法确保绝对安全，一旦被封号的话，似乎封号的是小号会更好一些。

总之你需要在事前准备好以下几项：
1. 一个B站账号
2. 一台电脑，手机无法完成这些操作
3. 一个浏览器，下文教学以Chrome浏览器为例。


### 获取流程

1. 首先按键盘的`Ctrl`+`Shift`+`N`开启一个新的无痕页面，这个页面不会带有原先的历史缓存，同时在这个页面中输入的信息会在关闭页面后被清空。

2. 访问B站，随便选择一个你喜欢的视频打开。

3. 按F12打开控制台窗口，通过这个窗口你可以访问浏览器中的后台数据，如果调整到合适位置，可以看到B站画出的欢迎字符画。

![sp01.png](https://github.com/Dark-Sword-22/danmuG/raw/main/misc/img/sp01.png)

4. 发送一条合适的弹幕。请注意需要在打开控制台后发送，因为开启后控制台才会开始记录内容。

5. 在控制台的最上方找到`网络`选项，如果你使用的是英文版它叫Network，它有可能藏在`>>`当中，然后选择`Fetch/XHR`

6. 下拉滚动条，在浏览器所有记录下的条目中，从下往上搜寻一个名为`post`的选项，就是我们需要的条目了。如下图。

![sp02.png](https://github.com/Dark-Sword-22/danmuG/raw/main/misc/img/sp02.png)

7. 打开后你会发现一个条目由常规，请求标头和响应标头三个部分组成，它们共同记录了这次网络通信的内容。如果你看到常规当中显示请求网址与下图一致，那么这就是我们需要找的那次请求了。

![sp03.png](https://github.com/Dark-Sword-22/danmuG/raw/main/misc/img/sp03.png)

8. 下拉，可以看到在请求标头中有cookie这一项，它一般比较长。这就是大名鼎鼎的饼干（cookie），由`项目名=项目值; `这种形式的很多项字符串组成，它负责在你请求时记录你的身份信息。我们需要在其中寻找`SESSDATA`和`bili_jct`这两项，如图中红框所示。

![sp04.png](https://github.com/Dark-Sword-22/danmuG/raw/main/misc/img/sp04.png)

9. 将他们（不包含末尾的空格和分号）依次填入config.ini文件的sessid和csrf_token处即可（理论上）使程序正常工作，如果你操作正确的话，sessid应该长为34位，csrftoken应该长为32位。（2022.2.26更新:由于B站更新策略，原sessid储存经过编码被取消，在更新节点后重新登录的用户获取的sessid长度可能为28位，格式类似于`a1234567,1600000000,ac130*22`，如果遇到这种情况请勿惊慌，最新版本客户端已经做出适配。对于原有的旧登录状态也不需要做任何修改，程序仍然保持兼容。）

以上
