# 参与重投须知
面向0基础用户的一些简单的说明，给开发人员的文档请看[这里](https://github.com/Dark-Sword-22/danmuG/blob/main/misc/%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3.md)。

### 这个脚本主要是干什么的
- 它主要被用来提供直播弹幕重投服务，也就是用来将直播弹幕转移至B站，提高B站录播视频的观看体验。
- 它的具体逻辑为，（向协调服务器请求要发送的内容-->发送并等待B站正常显示这个内容-->回报发送成功并等待30秒时间以防止触发B站的屏蔽机制）<---自动地重复上述过程。

### 我需要做什么
目前还是很缺人手的，如果你想参与帮助重投，你需要遵循以下步骤：

1. 下载release中的名为`dmclient.zip`的文件[（点击这里）](https://github.com/Dark-Sword-22/danmuG/releases)，它将本文件夹中的客户端脚本打包成一个完整的.exe可执行程序，使new ass们无需安装编程环境也能使用。当然，如果你是old ass，那么你也可以直接运行源码。
2. 下载后解压，文件夹中的`dmclient.exe`是程序启动的入口，由于没有界面，所有配置通过修改`config.ini`的方式完成。
3. 程序本身仅实现了将投递弹幕流程自动化的过程，也就是说不包括除此之外。在投稿前你仍然需要在普通浏览器中登录账号，并且记录下账号在B站的会话ID和反跨站保护令牌（SESSDATA和csrf token），并将其输入到`config.ini`的`sessid`和`csrf_token`的位置才能让程序正常以你的身份运行。对于完全不知道怎么获取的朋友请参考[这里](https://github.com/Dark-Sword-22/danmuG/blob/main/misc/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E7%9A%84ID%E4%BF%A1%E6%81%AF.md)。
4. 修改好信息后，正常工作时如下图。如果身份信息输入错误会提示读取失败并退出。
5. 正常启动程序后，如果你想关闭，请按`Ctrl`+`C`，这会让程序清空当前任务后退出，最好不要直接点击右上角`x`，因为这有可能导致某些弹幕被你领取后却未回报发送成功，导致服务器将这些弹幕标记为含有敏感词导致发送失败。

![pg01.png](https://github.com/Dark-Sword-22/danmuG/raw/main/misc/img/pg01.png)

### 一些更具体的配置项说明

配置项本身仅有几项，也没什么好配置的，大概说一下各自的作用。
- `sessid`和`csrf_id`分别代表会话身份信息和放跨站保护令牌，这个没什么好说的。
- `buvid`代表设备信息，可以可以选择直接删除这行，如果删除的话程序会为账号自动生成一个空白的设备信息。
- `cdn_server` 此项目表示协调服务器地址，本项目需要连接协调服务器才能正常使用，因为需要确保分散在各地的用户不会将同一条弹幕反复投递好几遍。目前服务器架设在 [https://dog.464933.xyz/](https://dog.464933.xyz/) 这个地址。
- `proxy` 表示http代理，如果你有的话，格式类似于`http://127.0.0.1:8080`，默认值`false`代表没有。
- `working_mode` 代表工作模式，其取值仅可以是`auto`和`specified`其中的一个。默认使用`auto`模式，程序开启后会自动从服务器下载最新视频的弹幕并投稿。如果你的程序开启后不管，使它7\*24运行，那么小秦如果在期间出了新视频，也会自动再换到新视频的弹幕。而`specified`则代表你非常喜欢某期视频，你只想要为这一期视频投弹幕。如果设置为此选项则程序开始时会提示你输入想要投稿的视频的链接。不过考虑到投递过程本身很慢，如果你是想要提高自己的观看体验的话建议放弃，因为等到弹幕全投上去可能是一周以后的事了。
- `worktime` 这是一个为服务器工作开设的选项，代表每天投稿时长，取值范围为1-24之间的整数。虽然按照目前投稿测试来看，以目前频率即使在24小时持久投递测试中也未发生过问题，但是我们不保证B站不会根据统计数据，比如当一个账号每周或每月发送总数量超过几万或者几十万以后就会被判定为机器人并拦截。所以针对于将本程序作为一个服务挂在服务器上7\*24小时运行的老哥设计了这么一个选项，每天投递会休息若干个小时，脱离人类的范畴会小一些。默认值为12，即每天工作12小时休息12小时。如果你是PC用户每天手动开启这个软件的话也许可以直接设置为24。- 21.12.09upd: up主投递弹幕约两万条后已经出现暂时投递失效的情况，休息一天后才得以恢复，如果有在服务器挂机的老哥推荐将工作时长设为每天投稿2小时左右。
- `userid` 代表你的用户名，可以是任意值。其作用仅用来记录你的贡献，贡献多了可以登上好哥哥排行榜。所以理论上你也可以写别人的ID，默认值为匿名。另外不保证包含标点符号或特殊字符时能正常显示。
- `loglevel` 默认为`INFO`，如果你想看到更多后台信息，可以设置为`DEBUG`模式。


### 常见Q&A

- 记录会话ID是否有安全风险？

是的，会话ID代表你的身份凭证，在任何程序中输入该凭证都有被该程序恶意利用的风险，如果遇到坏哥哥就会被用来做坏事。本程序不包含任何泄露你身份信息的代码，但作为一种安全常识，我应该提示你此行为具有风险。

- 参与投稿是否会被封号？

理论上非人为操作都会违反B站用户使用协议，你的账号存在因大量发送弹幕而被识别为灌水机器人的风险。虽然我们的投递策略设置得并不激进，但无人可以确保一定不会摸到阿B的GDIAN。目前根据开发过程中的一两周的测试来看是还好，除非投递敏感词，否则从未触发过什么拦截，不过我认为良好的习惯是永远不要使用主账号进行风险操作。

- 我不想看到直播弹幕应该怎么办？

如果非常喜欢录播的安静氛围而不想要看到直播弹幕，你可以手动关闭。通常投稿账号的登记都不会很高，你可以在弹幕设置里提高智能云屏蔽等级以过滤这些弹幕。

- 我可以修改源代码吗？

由于采用Python开源分发的策略，理论上程序源代码对用户完全透明。但我们不建议大家以任何形式私自修改源码，因为服务器本身是老哥用吃薯条的时间摸出来的，它并未构建完善的防护策略，如果有坏哥哥攻击以它的防御力很快会被玩坏。如果你对代码有任何修改建议请直接PR。
